<html>
<head>
 		<script src="sortableTable.js"></script> 
		<script>

// -------------------------------------------------------------------------------------------------------
// -----------------=============######## Sourtable Table Demo Code ########=============-----------------
// -------------------------------------------------------------------------------------------------------
//  Copyright a97marbr / HGustavs 
//
//        (\ /)
//        (. .)           
//       c(")(")                     âˆ´ 
//--------------------------------------------------------------------------------------------------------

//------------==========########### GLOBALS ###########==========------------

var tabledata={
	tblhead:[
		"First/Last","Pnr","Num","Foo","Holk","Trumma"
	],
	tblbody:[
		["Adam van Dyke","305","UNK","Zoopla","heblo",{xk:100,yk:3000}],
		["Zeus Flabber","307",11,"Golpla","greblo",{xk:200,yk:4}],
		["Clara Brook","107",21,"Foopla","treblo",{xk:500,yk:41}]
	],
	tblfoot:["","Pnr","Num","","","Trumma"]
}

var myTable;

//------------==========########### FUNCTIONZ ###########==========------------

//--------------------------------------------------------------------------
// setup
// ---------------
//  Creates the table object and assigns all mandatory pararmeters
//  
//  tbl,tableid,filterid,caption,renderCell,renderSortOptions,renderColumnFilter
//--------------------------------------------------------------------------

function setup(){
		myTable = new SortableTable(tabledata,"thetable","columnfilter","Booyah!",
				function(celldata,col,cellid){return renderCell(celldata,col,cellid)},
				function(col, kind){return renderSortOptions(col,kind)},
				function(col, status){return renderColumnFilter(col,status)},
				function(row){ return rowFilter(row)},
				["Pnr","Num","Trumma"],
				["RowSum","Pnr","Num"],				
				function(col, val){return makeSum(col,val);}
		);
		myTable.renderTable();
		
}

//--------------------------------------------------------------------------
// renderColumnFilter
// ---------------
//  Callback function that renders the col filter div
//--------------------------------------------------------------------------
		
function renderColumnFilter(col,status){
		
		str="";
		if(status){
				str="<label>"+col+"</label>:<input type='checkbox' checked onclick='myTable.toggleColumn(\""+col+"\")'>";
		}else{
				str="<label>"+col+"</label>:<input type='checkbox' onclick='myTable.toggleColumn(\""+col+"\")'>";
		}

		return str;
}

//--------------------------------------------------------------------------
// renderSortOptions
// ---------------
//  Callback function that renders the col filter div
//--------------------------------------------------------------------------
		
function renderSortOptions(col,status){
		str="";
		
		if(status==-1){
				if(col=="First/Last"){
						str+="<span onclick='myTable.toggleSortStatus(\"First/Last\",1)'>First</span>/";								
						str+="<span onclick='myTable.toggleSortStatus(\"First/Last\",3)'>Last</span>";								
				}else{
						str+="<span onclick='myTable.toggleSortStatus(\""+col+"\",1)'>"+col+"</span>";				
				}
		}else{
				if(col=="First/Last"){
						// First up/down vs Last up/down
						if(status==0||status==1){
								if(status==0){
										str+="<span onclick='myTable.toggleSortStatus(\"First/Last\",1)'>First&#x25b4;</span>/";								
								}else{
										str+="<span onclick='myTable.toggleSortStatus(\"First/Last\",0)'>First&#x25be;</span>/";								
								}
								str+="<span onclick='myTable.toggleSortStatus(\"First/Last\",2)'>Last</span>";								
						}
						else if(status==2||status==3){
								str+="<span onclick='myTable.toggleSortStatus(\"First/Last\",1)'>First</span>/";								
								if(status==2){
										str+="<span onclick='myTable.toggleSortStatus(\"First/Last\",3)'>Last&#x25b4;</span>";								
								}else{
										str+="<span onclick='myTable.toggleSortStatus(\"First/Last\",2)'>Last&#x25be;</span>";								
								}
						}		            
				} else if(col=="Trumma"){
						// Special sort for Trumma (JSON structure)
            str+="<span>"+col+"</span>";
            str+="<select onchange='myTable.toggleSortStatus(\""+col+"\",this.value)'>";
            str+="<option hidden disabled selected value>Select Sort</option>"
            str+="<option value='0'>x&#x25b4;/y</option>";
            str+="<option value='1'>x&#x25be;/y</option>";
            str+="<option value='2'>x/y&#x25b4;</option>";
            str+="<option value='3'>x/y&#x25be;</option>";
            str+="</select>";
				} else{
						if(status){
								str+="<span onclick='myTable.toggleSortStatus(\""+col+"\",0)'>"+col+"&#x25be;</span>";
						}else{
								str+="<span onclick='myTable.toggleSortStatus(\""+col+"\",1)'>"+col+"&#x25b4;</span>";
						}
				}
		}

		return str;
}

//--------------------------------------------------------------------------
// renderCell
// ---------------
//  Callback function that renders a specific cell in the table
//--------------------------------------------------------------------------
		
function renderCell(celldata,col){
    if (col=="Trumma"){
        return "<div><span>"+celldata.xk+"</span>/<span>"+celldata.yk+"</span></div>";
    } else if (col=="Pnr"){
        return "<div style='text-align:right'>"+celldata+"</div>";
    }    
		return celldata;
}

//--------------------------------------------------------------------------
// rowFilter
// ---------------
//  Callback function that filters rows in the table
//--------------------------------------------------------------------------
		
function rowFilter(row){
  
		return true;
}

//--------------------------------------------------------------------------
// compare
// ---------------
//  Callback function with different compare alternatives for the column sort
//--------------------------------------------------------------------------
function compare(a,b){
    // Find out which column and part of column are we sorting on from currentTable
    let col=currentTable.sortcolumn;
    let kind=currentTable.sortkind;
    
    if (col == "Trumma"){
        if(kind==0 || kind==1){ 
          return a.xk-b.xk; 
      } else if(kind==2 || kind==3){ 
          return a.yk-b.yk; 
      } 
    } else if (col == "First/Last"){
        // Sort Fname / Lname 
        if(kind==0 || kind==1){ 
            let afname=a.substr(0,a.indexOf(' '));
            let bfname=b.substr(0,b.indexOf(' '));
            if ( afname < bfname ) return -1; 
            if ( afname > bfname ) return 1; 
            return 0; 
        } else if(kind==2 || kind==3){ 
            let alname=a.substr(a.indexOf(' ')+1);
            let blname=b.substr(b.indexOf(' ')+1);
            if ( alname < blname ) return -1; 
            if ( alname > blname ) return 1; 
            return 0; 
        }
    } else if (col == "Foo" || col == "Holk"){
        if ( a < b ) return -1; 
        if ( a > b ) return 1; 
        return 0; 
    } else {
        // We allways sort none numbers below 
        let tmp=(currentTable.ascending) ? -1000000 : 1000000;
        
        let left = (isNaN(a)) ? tmp : +a; 
        let right = (isNaN(b)) ? tmp : +b; 
        
        return right-left;     
    }
}

//--------------------------------------------------------------------------
// makeSum
// ---------------
//	makeSum col,value  
//--------------------------------------------------------------------------

function makeSum(col,value){
		if(col=="Trumma"){
				return value.xk;
		}else{
				if(value=="UNK"){
						return 0;
				}else{
						return parseFloat(value);
				}
		}
		return 0;
}

		</script>
</head>
<body onload="setup();">

	<!-- Column filter div -->
	<div id="columnfilter"></div>
	
	<!-- Table placeholder -->
	<table style='border-collapse: collapse;' id='thetable'>
	</table>

</body>
